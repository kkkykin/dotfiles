#+title:      codex
#+date:       [2025-09-10 Wed 11:59]
#+filetags:   :work:
#+identifier: 20250910T115938

* tangle
#+begin_src elisp
(let* ((conf-dir (pcase system-type
                   ('windows-nt (substitute-in-file-name "$userprofile/.codex/"))
                   (_ (expand-file-name "~/.codex/"))))
       (zr-local-pls (plstore-open "../.global.pls"))
       (host (concat "litellm." (plist-get (cdr (plstore-get zr-local-pls "host")) :main)))
       (zr-local-pls (plstore-open (expand-file-name "litellm.pls" zr-secrets-dir)))
       (keys (cdr (plstore-get zr-local-pls "litellm")))
       (key (plist-get keys :cx)))
  (mkdir conf-dir t)
  (dolist (f (org-babel-tangle))
    (make-symbolic-link f conf-dir t)))
#+end_src

* config
:PROPERTIES:
:CUSTOM_ID: d8a4f6d4-d907-45d7-aec8-208d2353b81e
:END:
** main
:PROPERTIES:
:CUSTOM_ID: 2726e3c5-3391-4dc0-af41-b0df5a024f78
:END:
#+header: :var host=(concat host)
#+begin_src toml :tangle (zr-org-by-tangle-dir "config.toml") :mkdirp t
model_provider = "main"
model = "gpt-5.2-codex"
model_reasoning_effort = "xhigh"
disable_response_storage = true
sandbox_mode = "workspace-write" 

[features]
plan_tool = true
apply_patch_freeform = true
view_image_tool = true
web_search_request = true
streamable_shell = false
rmcp_client = true

[model_providers.main]
name = "main"
base_url = "https://$host/v1"
wire_api = "responses"
requires_openai_auth = true

[sandbox_workspace_write]
network_access = true
#+end_src
** auth
:PROPERTIES:
:CUSTOM_ID: bb6a8f50-0139-42ad-9db0-7b9a3eed9323
:END:
#+header: :var key=(identity key)
#+begin_src json :comments no :tangle (zr-org-by-tangle-dir "auth.json")
{
  "OPENAI_API_KEY": "$key"
}
#+end_src
