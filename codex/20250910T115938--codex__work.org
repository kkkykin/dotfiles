#+title:      codex
#+date:       [2025-09-10 Wed 11:59]
#+filetags:   :work:
#+identifier: 20250910T115938

* tangle
#+begin_src elisp
(let* ((conf-dir (pcase system-type
                   ('windows-nt (substitute-in-file-name "$userprofile/.codex/"))
                   (_ (expand-file-name "~/.codex/"))))
       (zr-local-pls (plstore-open "../.global.pls"))
       (host (concat "litellm." (plist-get (cdr (plstore-get zr-local-pls "host")) :main)))
       (key (auth-source-pick-first-password :host host :user "codex")))
  (mkdir conf-dir t)
  (dolist (f (org-babel-tangle))
    (make-symbolic-link f conf-dir t)))
#+end_src

* config
:PROPERTIES:
:CUSTOM_ID: d8a4f6d4-d907-45d7-aec8-208d2353b81e
:END:
** main
:PROPERTIES:
:CUSTOM_ID: 2726e3c5-3391-4dc0-af41-b0df5a024f78
:END:
#+header: :var host=(concat host) user=(user-full-name)
#+begin_src toml :tangle (zr-org-by-tangle-dir "config.toml") :mkdirp t
disable_response_storage = true
model = "gpt-5.2"
model_reasoning_effort = "xhigh"
model_provider = "main"
sandbox_mode="danger-full-access"
windows_wsl_setup_acknowledged = true
base_instructions = "Always prefer built-in tools (read_file, list_dir, grep_files) over shell commands for file operations."
[experimental]
use_freeform_apply_patch = true
use_unified_exec_tool = true

[features]
apply_patch_freeform = true
ghost_commit = true
plan_tool = true
rmcp_client = true
streamable_shell = false
unified_exec = false
view_image_tool = true
web_search_request = true
experimental_windows_sandbox = true
experimental_sandbox_command_assessment = true
parallel = true

[model_providers.main]
base_url = "https://$host/v1"
name = "main"
requires_openai_auth = true
wire_api = "responses"

[sandbox_workspace_write]
network_access = true
writable_roots = ["/home/$user/.cache", "/home/$user/.local"]
#+end_src
** auth
:PROPERTIES:
:CUSTOM_ID: bb6a8f50-0139-42ad-9db0-7b9a3eed9323
:END:
#+header: :var key=(identity key)
#+begin_src json :comments no :tangle (zr-org-by-tangle-dir "auth.json")
{
  "OPENAI_API_KEY": "$key"
}
#+end_src
